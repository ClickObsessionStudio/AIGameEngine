<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><title>Pocket Pong: 2-Player</title><style>
  :root{
    --bg:#000;
    --fg:#fff;
    --accent:#ffeb3b;
    --accent2:#29b6f6;
    --accent3:#ff7043;
    --ui:#111;
    --ui2:#1b1b1b;
    --muted:#aaa;
    --btn:#222;
    --btn-hover:#2e2e2e;
    --focus:#7c4dff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;background:var(--bg);color:var(--fg);}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.2;-webkit-tap-highlight-color:transparent}
  button,select{font:inherit}
  .wrap{max-width:920px;margin:0 auto;padding:12px;display:flex;flex-direction:column;gap:10px}
  h1{font-size:1.3rem;margin:4px 0}
  .topbar{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .spacer{flex:1}
  .scorebox{display:flex;gap:10px;align-items:center}
  .score{display:flex;gap:8px;align-items:center}
  .badge{display:inline-block;padding:.2rem .5rem;border-radius:.4rem;background:var(--ui2);color:var(--fg);min-width:2ch;text-align:center}
  .badge.blue{background:linear-gradient(180deg,#0d47a1,#1565c0)}
  .badge.orange{background:linear-gradient(180deg,#e65100,#ef6c00)}
  .wins{font-size:.85rem;color:var(--muted)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .controls>*{min-height:44px}
  button, select{background:var(--btn);color:var(--fg);border:1px solid #444;border-radius:.6rem;padding:.6rem .8rem;cursor:pointer}
  button:hover, select:hover{background:var(--btn-hover)}
  button:active{transform:translateY(1px)}
  button:focus-visible, select:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  .canvasWrap{position:relative;border:2px solid #333;border-radius:10px;background:linear-gradient(180deg,#000,#0a0a0a);overflow:hidden}
  canvas{display:block;width:100%;height:auto}
  .midline{position:absolute;left:50%;top:0;bottom:0;border-left:2px dashed #444;pointer-events:none}
  .message{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;text-align:center;pointer-events:none}
  .message .bubble{pointer-events:auto;background:rgba(17,17,17,.9);border:1px solid #444;padding:10px 12px;border-radius:10px;max-width:80%;margin:0 auto}
  .message button{pointer-events:auto}
  /* Touch zones and pads */
  .zones{position:absolute;inset:0;display:flex;justify-content:space-between;pointer-events:none}
  .zone{flex:1;position:relative}
  .ctrls{position:absolute;bottom:8px;left:8px;right:8px;display:flex;justify-content:space-between;gap:8px;pointer-events:auto}
  .ctrl{flex:1;min-width:44px;min-height:56px;border-radius:.8rem;border:2px solid #444;background:#121212;color:#eee}
  .ctrl:active{background:#1b1b1b}
  .ctrl b{display:block;font-size:1rem}
  .hint{position:absolute;top:8px;left:8px;right:8px;text-align:center;font-size:.8rem;color:#bbb;text-shadow:0 1px 0 #000;pointer-events:none}
  .left .hint{color:#9cd1ff}
  .right .hint{color:#ffc49c}
  /* Help section */
  details{background:var(--ui);border:1px solid #333;border-radius:.6rem;padding:.4rem .6rem}
  details[open]{background:#0f0f0f}
  summary{cursor:pointer}
  .sr{position:absolute!important;width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  @media (prefers-reduced-motion: reduce){
    *{scroll-behavior:auto!important;transition:none!important;animation:none!important}
  }
</style></head><body>
  <div class="wrap">
    <div class="topbar" role="group" aria-label="Game header">
      <h1>Pocket Pong: 2-Player</h1>
      <div class="spacer"></div>
      <div class="scorebox" aria-live="polite">
        <div class="score" aria-label="Left player score">
          <span class="badge blue" aria-hidden="true">L</span>
          <span id="scoreL" class="badge">0</span>
          <span class="wins">wins: <b id="winsL">0</b></span>
        </div>
        <div class="score" aria-label="Right player score">
          <span class="badge orange" aria-hidden="true">R</span>
          <span id="scoreR" class="badge">0</span>
          <span class="wins">wins: <b id="winsR">0</b></span>
        </div>
      </div>
    </div>
    <div class="controls" role="group" aria-label="Game controls">
      <button id="btnToggle" aria-pressed="false" title="Start or pause (Space)">Play</button>
      <button id="btnNew" title="Reset points and start a new match">New Match</button>
      <label for="target" class="sr">Target points</label>
      <select id="target" title="Target points to win">
        <option value="3">First to 3</option>
        <option value="5">First to 5</option>
        <option value="7" selected>First to 7</option>
        <option value="11">First to 11</option>
      </select>
      <button id="btnReset" title="Clear saved wins">Reset All</button>
      <div class="spacer"></div>
    </div>

    <div class="canvasWrap" id="stage" aria-label="Pong playfield" role="application">
      <canvas id="field" width="800" height="480" aria-label="Game canvas"></canvas>
      <div class="midline" aria-hidden="true"></div>
      <div id="msg" class="message" aria-live="polite">
        <div class="bubble">
          <div id="msgText">Tap Play or press Space to start</div>
          <div style="margin-top:6px">
            <button id="btnServe">Serve</button>
          </div>
        </div>
      </div>
      <div class="zones" aria-hidden="false">
        <div class="zone left" id="zoneL">
          <div class="hint">Left: W/S or use pads</div>
          <div class="ctrls">
            <button class="ctrl" data-side="L" data-dir="-1" aria-label="Left up"><b>Up</b></button>
            <button class="ctrl" data-side="L" data-dir="1" aria-label="Left down"><b>Down</b></button>
          </div>
        </div>
        <div class="zone right" id="zoneR">
          <div class="hint">Right: ↑/↓ or use pads</div>
          <div class="ctrls">
            <button class="ctrl" data-side="R" data-dir="-1" aria-label="Right up"><b>Up</b></button>
            <button class="ctrl" data-side="R" data-dir="1" aria-label="Right down"><b>Down</b></button>
          </div>
        </div>
      </div>
    </div>

    <details>
      <summary>Help / About</summary>
      <div>
        <p>Two players, one device. Move paddles to bounce the ball past your opponent. First to the selected target wins a match. Wins persist locally (Reset All clears them).</p>
        <ul>
          <li>Left Player: W/S keys, or left Up/Down pads, or drag/tap left half.</li>
          <li>Right Player: Arrow Up/Down keys, or right pads, or drag/tap right half.</li>
          <li>Space/Enter: Play/Pause. Click/Touch Serve between points.</li>
          <li>Reduced Motion respected: slower ball and gentler speed-ups.</li>
        </ul>
        <p>Made to be accessible: high contrast, large tap targets, keyboard support, and focus-visible highlights.</p>
      </div>
    </details>
  </div>

<script>
(function(){
  'use strict';
  const cvs = document.getElementById('field');
  const ctx = cvs.getContext('2d');
  const stage = document.getElementById('stage');
  const msgWrap = document.getElementById('msg');
  const msgText = document.getElementById('msgText');
  const btnServe = document.getElementById('btnServe');
  const scoreL = document.getElementById('scoreL');
  const scoreR = document.getElementById('scoreR');
  const winsL = document.getElementById('winsL');
  const winsR = document.getElementById('winsR');
  const btnToggle = document.getElementById('btnToggle');
  const btnNew = document.getElementById('btnNew');
  const btnReset = document.getElementById('btnReset');
  const targetSel = document.getElementById('target');
  const zoneL = document.getElementById('zoneL');
  const zoneR = document.getElementById('zoneR');

  const mediaReduced = matchMedia('(prefers-reduced-motion: reduce)');
  let reduced = mediaReduced.matches;
  mediaReduced.addEventListener('change',e=>{reduced=e.matches;});

  let W = cvs.width, H = cvs.height;
  const pad = { w: 10, h: 80, margin: 12 };
  const colors = {bg:'#000', wall:'#2a2a2a', left:'#29b6f6', right:'#ff7043', ball:'#ffeb3b'};

  const state = {
    L: {y: H/2, vy:0, score:0, wins:0},
    R: {y: H/2, vy:0, score:0, wins:0},
    ball: {x: W/2, y:H/2, vx:0, vy:0, r:6, speed:220},
    running:false,
    serving:true,
    last:0,
    target: Number(targetSel.value) || 7,
    serveDir: Math.random()<.5?-1:1,
    key:{w:false,s:false,up:false,down:false},
    press:{L:-0,R:-0},
    message:''
  };

  function save(){
    try{ localStorage.setItem('pong2p_v1', JSON.stringify({wL:state.L.wins,wR:state.R.wins,target:state.target})); }catch(e){}
  }
  function load(){
    try{ const d = JSON.parse(localStorage.getItem('pong2p_v1')||'{}');
      if(Number.isFinite(d.wL)) state.L.wins = d.wL;
      if(Number.isFinite(d.wR)) state.R.wins = d.wR;
      if([3,5,7,11].includes(d.target)) { state.target=d.target; targetSel.value=String(d.target);} 
    }catch(e){}
  }
  load();
  updateHUD();

  function resize(){
    // Responsive: fit width, cap by height
    const maxW = Math.min(920, window.innerWidth-24);
    let w = Math.max(320, maxW);
    let h = Math.round(w*0.6);
    const maxH = Math.max(240, Math.floor(window.innerHeight*0.7));
    if(h>maxH){ h=maxH; w=Math.round(h/0.6); }
    cvs.width = w; cvs.height = h;
    W=w; H=h;
    pad.h = Math.max(60, Math.round(H*0.18));
    state.ball.r = Math.max(5, Math.round(H*0.012));
    draw();
  }
  window.addEventListener('resize', resize, {passive:true});
  resize();

  function resetBall(dir){
    state.ball.x = W/2; state.ball.y = H/2;
    const base = reduced?160:240;
    state.ball.speed = base;
    const angle = (Math.random()*0.6 - 0.3); // -0.3..0.3 rad vertical skew
    state.ball.vx = Math.cos(angle)*base * (dir||state.serveDir);
    state.ball.vy = Math.sin(angle)*base;
  }

  function newMatch(){
    state.L.score=0; state.R.score=0;
    state.running=false; state.serving=true;
    state.serveDir = Math.random()<.5?-1:1;
    resetBall(state.serveDir);
    updateHUD();
    showMessage('New match! Tap Serve to begin.');
  }

  function showMessage(t){
    state.message=t; msgText.textContent=t; msgWrap.style.display='flex';
  }
  function hideMessage(){ msgWrap.style.display='none'; }

  function updateHUD(){
    scoreL.textContent = state.L.score;
    scoreR.textContent = state.R.score;
    winsL.textContent = state.L.wins;
    winsR.textContent = state.R.wins;
  }

  function start(){
    state.running=true; hideMessage(); btnToggle.textContent='Pause'; btnToggle.setAttribute('aria-pressed','true');
  }
  function pause(){
    state.running=false; btnToggle.textContent='Play'; btnToggle.setAttribute('aria-pressed','false');
    if(state.serving) showMessage(state.message||'Tap Serve to begin');
  }

  btnToggle.addEventListener('click', ()=>{
    if(state.running){ pause(); }
    else{ if(state.serving){ resetBall(); state.serving=false; }
      start(); requestAnimationFrame(loop);
    }
  });
  btnNew.addEventListener('click', ()=>{ newMatch(); pause(); });
  btnReset.addEventListener('click', ()=>{
    try{ localStorage.removeItem('pong2p_v1'); }catch(e){}
    state.L.wins=0; state.R.wins=0; save(); updateHUD();
    showMessage('Saved wins cleared.');
  });
  targetSel.addEventListener('change', ()=>{ state.target=Number(targetSel.value)||7; save(); });

  btnServe.addEventListener('click', ()=>{
    resetBall(); state.serving=false; hideMessage(); start(); requestAnimationFrame(loop);
  });

  // Keyboard
  window.addEventListener('keydown', (e)=>{
    if(e.repeat) return;
    const k=e.key.toLowerCase();
    if(k===' '||k==='enter'){ e.preventDefault(); btnToggle.click(); return; }
    if(k==='w'){ state.key.w=true; }
    if(k==='s'){ state.key.s=true; }
    if(e.key==='ArrowUp'){ state.key.up=true; }
    if(e.key==='ArrowDown'){ state.key.down=true; }
  });
  window.addEventListener('keyup', (e)=>{
    const k=e.key.toLowerCase();
    if(k==='w'){ state.key.w=false; }
    if(k==='s'){ state.key.s=false; }
    if(e.key==='ArrowUp'){ state.key.up=false; }
    if(e.key==='ArrowDown'){ state.key.down=false; }
  });

  // Pause on blur
  window.addEventListener('blur', ()=>{ if(state.running){ pause(); showMessage('Paused (window lost focus)'); } });

  // Pad buttons (pointer)
  function padPress(side, dir, on){ state.press[side]= on?dir:0; }
  stage.addEventListener('pointerdown', (e)=>{ if(state.serving){ e.preventDefault(); btnServe.click(); } });
  stage.addEventListener('touchstart', (e)=>{ if(state.serving){ e.preventDefault(); btnServe.click(); } }, {passive:false});

  stage.querySelectorAll('.ctrl').forEach(btn=>{
    const side=btn.getAttribute('data-side');
    const dir=Number(btn.getAttribute('data-dir'));
    function down(ev){ ev.preventDefault(); padPress(side, dir, true);} 
    function up(){ padPress(side, dir, false);} 
    btn.addEventListener('pointerdown', down);
    btn.addEventListener('pointerup', up);
    btn.addEventListener('pointercancel', up);
    btn.addEventListener('pointerleave', up);
  });

  function zoneDrag(zoneEl, side){
    function posToY(clientY){
      const rect = cvs.getBoundingClientRect();
      return Math.min(H - pad.h/2, Math.max(pad.h/2, (clientY - rect.top) * (H/rect.height)));
    }
    zoneEl.addEventListener('pointerdown', (e)=>{
      if(e.pointerType==='mouse' && e.button!==0) return;
      if(state.serving){ btnServe.click(); return; }
      const y = posToY(e.clientY);
      state[side].y = y;
    });
    zoneEl.addEventListener('pointermove', (e)=>{
      if(e.pressure===0 && e.buttons===0) return; // not dragging
      const y = posToY(e.clientY);
      state[side].y = y;
    });
  }
  zoneDrag(zoneL,'L');
  zoneDrag(zoneR,'R');

  function movePaddles(dt){
    const speed = reduced? 380 : 520;
    const L = state.L, R = state.R;
    let vyL = 0, vyR = 0;
    if(state.key.w) vyL -= 1; if(state.key.s) vyL += 1; vyL += state.press.L||0;
    if(state.key.up) vyR -= 1; if(state.key.down) vyR += 1; vyR += state.press.R||0;
    L.vy = vyL*speed; R.vy = vyR*speed;
    if(vyL!==0){ L.y += L.vy*dt; }
    if(vyR!==0){ R.y += R.vy*dt; }
    const half = pad.h/2;
    L.y = Math.max(half, Math.min(H-half, L.y));
    R.y = Math.max(half, Math.min(H-half, R.y));
  }

  function clamp(v,min,max){ return v<min?min:(v>max?max:v); }

  function updateBall(dt){
    const b = state.ball; b.x += b.vx*dt; b.y += b.vy*dt;
    // Top/bottom walls
    if(b.y - b.r < 0){ b.y = b.r; b.vy = Math.abs(b.vy); }
    else if(b.y + b.r > H){ b.y = H - b.r; b.vy = -Math.abs(b.vy); }
    // Left paddle
    const pL = {x: pad.margin, y: state.L.y, w: pad.w, h: pad.h};
    const pR = {x: W - pad.margin - pad.w, y: state.R.y, w: pad.w, h: pad.h};
    // Collision function
    function collideRect(p, side){
      const left = p.x, right = p.x+p.w, top = p.y - p.h/2, bottom = p.y + p.h/2;
      if(b.x + b.r > left && b.x - b.r < right && b.y + b.r > top && b.y - b.r < bottom){
        // place outside
        if(side==='L'){ b.x = right + b.r; }
        else { b.x = left - b.r; }
        // compute bounce angle
        const rel = clamp((b.y - p.y) / (p.h/2), -1, 1);
        const maxAng = Math.PI * 0.40; // ±72°
        // speed up slightly
        const cur = Math.hypot(b.vx, b.vy);
        const mul = reduced?1.02:1.06;
        const ns = Math.min(cur*mul, reduced?420:900);
        const ang = rel * maxAng;
        const dir = side==='L' ? 1 : -1;
        b.vx = Math.cos(ang) * ns * dir;
        b.vy = Math.sin(ang) * ns + (side==='L'?state.L.vy:state.R.vy)*0.15;
      }
    }
    if(b.vx < 0) collideRect(pL,'L'); else collideRect(pR,'R');

    // Score
    if(b.x + b.r < 0){ // Right scores
      point('R');
    } else if(b.x - b.r > W){ // Left scores
      point('L');
    }
  }

  function point(side){
    state[side].score++;
    updateHUD();
    // Check match end
    if(state[side].score >= state.target){
      state[side].wins++; save(); updateHUD();
      state.running=false; state.serving=true; state.serveDir = (side==='L')?-1:1; // serve to loser next
      showMessage((side==='L'?'Left':'Right')+' wins the match! New Match to play again.');
      btnToggle.textContent='Play'; btnToggle.setAttribute('aria-pressed','false');
    } else {
      state.running=false; state.serving=true; state.serveDir = (side==='L')?-1:1; // ball goes to the other side
      resetBall(state.serveDir);
      showMessage((side==='L'?'Left':'Right')+' scores! Tap Serve for next rally.');
      btnToggle.textContent='Play'; btnToggle.setAttribute('aria-pressed','false');
    }
  }

  function draw(){
    ctx.fillStyle = colors.bg; ctx.fillRect(0,0,W,H);
    // center guide dots
    ctx.strokeStyle = '#222'; ctx.lineWidth = 2; ctx.setLineDash([8,10]);
    ctx.beginPath(); ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke(); ctx.setLineDash([]);
    // walls
    ctx.fillStyle = colors.wall; ctx.fillRect(0,0,W,4); ctx.fillRect(0,H-4,W,4);
    // paddles
    ctx.fillStyle = colors.left; ctx.fillRect(pad.margin, state.L.y - pad.h/2, pad.w, pad.h);
    ctx.fillStyle = colors.right; ctx.fillRect(W - pad.margin - pad.w, state.R.y - pad.h/2, pad.w, pad.h);
    // ball
    ctx.fillStyle = colors.ball; ctx.beginPath(); ctx.arc(state.ball.x, state.ball.y, state.ball.r, 0, Math.PI*2); ctx.fill();
  }

  function loop(ts){
    if(!state.last) state.last = ts; const dt = Math.min(0.033, (ts - state.last)/1000); state.last = ts;
    movePaddles(dt);
    updateBall(dt);
    draw();
    if(state.running) requestAnimationFrame(loop);
  }

  // Initialize
  newMatch(); // sets serving and message, preserves wins
  // but after load, show persistent wins
  updateHUD();
})();
</script>
</body></html>